<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f5f5f7;
      margin:0;
      padding:20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background:#ffffff;
      padding:20px 30px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
    }
    h1, h2, h3 {
      margin-top:0;
    }
    label {
      display:block;
      margin-top:10px;
      font-weight:600;
    }
    input[type="text"],
    input[type="date"],
    textarea,
    select {
      width:100%;
      padding:8px;
      margin-top:4px;
      box-sizing:border-box;
      border:1px solid #ccc;
      border-radius:4px;
      font-size:14px;
    }
    textarea {
      resize:vertical;
      min-height:60px;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size:13px;
    }
    th, td {
      border:1px solid #ddd;
      padding:6px 8px;
      text-align:left;
    }
    th {
      background:#f0f0f5;
    }
    .btn-row {
      margin-top:15px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    button {
      padding:8px 16px;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-size:14px;
    }
    .btn-primary {
      background:#007bff;
      color:#fff;
    }
    .btn-primary:hover {
      background:#0056b3;
    }
    .btn-secondary {
      background:#6c757d;
      color:#fff;
    }
    .btn-secondary:hover {
      background:#545b62;
    }
    .status-done {
      color:#1e7e34;
      font-weight:bold;
    }
    .status-not-done {
      color:#c82333;
      font-weight:bold;
    }
    .status-in-progress {
      color:#e0a800;
      font-weight:bold;
    }
    .summary-box {
      border-left:4px solid #007bff;
      background:#f7f9ff;
      padding:10px 12px;
      margin-top:10px;
      font-size:13px;
    }
    #reportPreview {
      margin-top:30px;
      padding:20px;
      border-radius:10px;
      background:#ffffff;
      box-shadow:0 4px 10px rgba(0,0,0,0.06);
    }
    .small {
      font-size:12px;
      color:#666;
    }
  </style>

  <!-- jsPDF + html2canvas –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

<div class="container">
  <h1>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞</h1>
  <p class="small">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ, –Ω–∞–∂–º–∏—Ç–µ ¬´–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç¬ª, –∑–∞—Ç–µ–º ¬´–°–∫–∞—á–∞—Ç—å PDF¬ª.</p>

  <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
  <div id="formBlock">
    <h2>–®–∞–ø–∫–∞ –æ—Ç—á—ë—Ç–∞</h2>
    <label>–î–∞—Ç–∞:
      <input type="date" id="date">
    </label>
    <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:
      <input type="text" id="employee" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–æ–º–∞–Ω –î–∏–∞–Ω–∞">
    </label>
    <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å:
      <input type="text" id="role" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–û–ú, –ê–≤–∏—Ç–æ–ª–æ–≥, SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç">
    </label>
    <label>–§–æ–∫—É—Å –¥–Ω—è (–≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å):
      <textarea id="focus" placeholder="–ö—Ä–∞—Ç–∫–æ: —á—Ç–æ –≥–ª–∞–≤–Ω–æ–µ —Å–µ–≥–æ–¥–Ω—è?"></textarea>
    </label>

    <h2>–ó–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å (–æ–±—â–∏–π –ø–ª–∞–Ω)</h2>
    <label>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (–ø–ª–∞–Ω –Ω–∞ –¥–µ–Ω—å):
      <textarea id="dayPlan" placeholder="–°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –¥–µ–Ω—å, —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏."></textarea>
    </label>

    <h2>–ü–ª–∞–Ω / —Ñ–∞–∫—Ç –ø–æ –ª–∏–¥–∞–º</h2>
    <p class="small">–û—Ç–¥–µ–ª—å–Ω—ã–π —É—á—ë—Ç –ø–æ –ª–∏–¥–∞–º (–ø–æ –∫–∞–Ω–∞–ª–∞–º).</p>
    <table id="leadsTable">
      <thead>
      <tr>
        <th>–ö–∞–Ω–∞–ª</th>
        <th>–ü–ª–∞–Ω –ª–∏–¥–æ–≤</th>
        <th>–§–∞–∫—Ç –ª–∏–¥–æ–≤</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><input type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤–∏—Ç–æ, –¢–ì, –í–ö"></td>
        <td><input type="text" value="0"></td>
        <td><input type="text" value="0"></td>
        <td>
          <select>
            <option value="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
            <option value="in_progress">‚è≥ –í —Ä–∞–±–æ—Ç–µ</option>
            <option value="not_done">‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ</option>
          </select>
        </td>
        <td><input type="text" placeholder="–ö—Ä–∞—Ç–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
      </tr>
      </tbody>
    </table>
    <div class="btn-row">
      <button type="button" class="btn-secondary" onclick="addLeadsRow()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</button>
    </div>

    <h2>–ü–ª–∞–Ω / —Ñ–∞–∫—Ç –ø–æ –∑–∞–¥–∞—á–∞–º</h2>
    <p class="small">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å—Å–∫–∞—è —á–∞—Å—Ç—å: –∫–æ–Ω—Ç–µ–Ω—Ç, –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ä–≥-–∑–∞–¥–∞—á–∏ –∏ —Ç.–ø.</p>
    <table id="tasksTable">
      <thead>
      <tr>
        <th>–ó–∞–¥–∞—á–∞</th>
        <th>–¢–∏–ø</th>
        <th>–ü–ª–∞–Ω (–µ–¥.)</th>
        <th>–§–∞–∫—Ç (–µ–¥.)</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><input type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–æ—Ä–∏—Å –¥–ª—è TG"></td>
        <td><input type="text" placeholder="–ö–æ–Ω—Ç–µ–Ω—Ç / –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ / –æ—Ä–≥"></td>
        <td><input type="text" value="0"></td>
        <td><input type="text" value="0"></td>
        <td>
          <select>
            <option value="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
            <option value="in_progress">‚è≥ –í —Ä–∞–±–æ—Ç–µ</option>
            <option value="not_done">‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ</option>
          </select>
        </td>
        <td><input type="text" placeholder="–ö—Ä–∞—Ç–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
      </tr>
      </tbody>
    </table>
    <div class="btn-row">
      <button type="button" class="btn-secondary" onclick="addTaskRow()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>

    <h2>–£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h2>
    <p class="small">–§–∏–∫—Å–∏—Ä—É–µ–º –∫–ª—é—á–µ–≤—ã–µ –±–ª–æ–∫–∏ —Ä–∞–±–æ—Ç—ã –∏ –≤—Ä–µ–º—è.</p>
    <table id="timeTable">
      <thead>
      <tr>
        <th>–ó–∞–¥–∞—á–∞ / –±–ª–æ–∫</th>
        <th>–ù–∞—á–∞–ª–æ</th>
        <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td><input type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–æ—Ä–∏—Å –¥–ª—è TG"></td>
        <td><input type="text" placeholder="10:00"></td>
        <td><input type="text" placeholder="11:30"></td>
        <td><input type="text" placeholder="–ß—Ç–æ –¥–µ–ª–∞–ª–∏ –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥"></td>
      </tr>
      </tbody>
    </table>
    <div class="btn-row">
      <button type="button" class="btn-secondary" onclick="addTimeRow()">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏</button>
    </div>

    <h2>–ò—Ç–æ–≥–∏ –¥–Ω—è –∏ –ø–ª–∞–Ω</h2>
    <label>–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ö–æ—Ä–æ—à–æ:
      <textarea id="good" placeholder="–ö—Ä–∞—Ç–∫–æ: —á—Ç–æ —É–¥–∞–ª–æ—Å—å, –≥–¥–µ –º–æ–ª–æ–¥–µ—Ü"></textarea>
    </label>
    <label>–ß—Ç–æ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ / –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ:
      <textarea id="bad" placeholder="–ö—Ä–∞—Ç–∫–æ: —á—Ç–æ –Ω–µ —É—Å–ø–µ–ª–∏ –∏ –ø–æ—á–µ–º—É"></textarea>
    </label>
    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞:
      <textarea id="tomorrow" placeholder="3‚Äì5 –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –∑–∞–≤—Ç—Ä–∞"></textarea>
    </label>

    <div class="btn-row">
      <button type="button" class="btn-primary" onclick="generateReport()">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
      <button type="button" class="btn-secondary" onclick="downloadPDF()">–°–∫–∞—á–∞—Ç—å PDF</button>
    </div>
  </div>

  <!-- –ü—Ä–µ–≤—å—é –æ—Ç—á—ë—Ç–∞, –∏–∑ –Ω–µ–≥–æ –¥–µ–ª–∞–µ–º PDF -->
  <div id="reportPreview" style="display:none;">
    <!-- —Å—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç -->
  </div>
</div>

<script>
  function addLeadsRow() {
    const tbody = document.querySelector('#leadsTable tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" placeholder="–ö–∞–Ω–∞–ª"></td>
      <td><input type="text" value="0"></td>
      <td><input type="text" value="0"></td>
      <td>
        <select>
          <option value="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
          <option value="in_progress">‚è≥ –í —Ä–∞–±–æ—Ç–µ</option>
          <option value="not_done">‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ</option>
        </select>
      </td>
      <td><input type="text" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
    `;
    tbody.appendChild(tr);
  }

  function addTaskRow() {
    const tbody = document.querySelector('#tasksTable tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" placeholder="–ó–∞–¥–∞—á–∞"></td>
      <td><input type="text" placeholder="–¢–∏–ø"></td>
      <td><input type="text" value="0"></td>
      <td><input type="text" value="0"></td>
      <td>
        <select>
          <option value="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
          <option value="in_progress">‚è≥ –í —Ä–∞–±–æ—Ç–µ</option>
          <option value="not_done">‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ</option>
        </select>
      </td>
      <td><input type="text" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
    `;
    tbody.appendChild(tr);
  }

  function addTimeRow() {
    const tbody = document.querySelector('#timeTable tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" placeholder="–ó–∞–¥–∞—á–∞ / –±–ª–æ–∫"></td>
      <td><input type="text" placeholder="–ù–∞—á–∞–ª–æ"></td>
      <td><input type="text" placeholder="–û–∫–æ–Ω—á–∞–Ω–∏–µ"></td>
      <td><input type="text" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
    `;
    tbody.appendChild(tr);
  }

  function generateReport() {
    const date = document.getElementById('date').value;
    const employee = document.getElementById('employee').value;
    const role = document.getElementById('role').value;
    const focus = document.getElementById('focus').value;
    const dayPlan = document.getElementById('dayPlan').value;
    const good = document.getElementById('good').value;
    const bad = document.getElementById('bad').value;
    const tomorrow = document.getElementById('tomorrow').value;

    // –õ–∏–¥—ã
    const leadsRows = document.querySelectorAll('#leadsTable tbody tr');
    let leadsHtml = '';
    let leadsPlanTotal = 0;
    let leadsFactTotal = 0;
    let leadsDoneCount = 0;
    let leadsTotal = 0;

    leadsRows.forEach(row => {
      const tds = row.querySelectorAll('td');
      const channel = tds[0].querySelector('input').value;
      const plan = parseFloat(tds[1].querySelector('input').value || '0');
      const fact = parseFloat(tds[2].querySelector('input').value || '0');
      const statusVal = tds[3].querySelector('select').value;
      const comment = tds[4].querySelector('input').value;

      let statusText = '';
      let statusClass = '';
      if (statusVal === 'done') {
        statusText = '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
        statusClass = 'status-done';
        leadsDoneCount++;
      } else if (statusVal === 'in_progress') {
        statusText = '‚è≥ –í —Ä–∞–±–æ—Ç–µ';
        statusClass = 'status-in-progress';
      } else {
        statusText = '‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ';
        statusClass = 'status-not-done';
      }

      leadsPlanTotal += plan;
      leadsFactTotal += fact;
      leadsTotal++;

      leadsHtml += `
        <tr>
          <td>${channel}</td>
          <td>${plan}</td>
          <td>${fact}</td>
          <td class="${statusClass}">${statusText}</td>
          <td>${comment}</td>
        </tr>
      `;
    });

    const leadsPercent = leadsPlanTotal > 0 ? Math.round((leadsFactTotal / leadsPlanTotal) * 100) : 0;
    const leadsDonePercent = leadsTotal > 0 ? Math.round((leadsDoneCount / leadsTotal) * 100) : 0;

    // –ó–∞–¥–∞—á–∏
    const taskRows = document.querySelectorAll('#tasksTable tbody tr');
    let tasksHtml = '';
    let totalPlannedTasks = 0;
    let totalFactTasks = 0;
    let doneCount = 0;
    let totalTasks = 0;

    taskRows.forEach(row => {
      const tds = row.querySelectorAll('td');
      const task = tds[0].querySelector('input').value;
      const type = tds[1].querySelector('input').value;
      const plan = parseFloat(tds[2].querySelector('input').value || '0');
      const fact = parseFloat(tds[3].querySelector('input').value || '0');
      const statusVal = tds[4].querySelector('select').value;
      const comment = tds[5].querySelector('input').value;

      let statusText = '';
      let statusClass = '';
      if (statusVal === 'done') {
        statusText = '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
        statusClass = 'status-done';
        doneCount++;
      } else if (statusVal === 'in_progress') {
        statusText = '‚è≥ –í —Ä–∞–±–æ—Ç–µ';
        statusClass = 'status-in-progress';
      } else {
        statusText = '‚ùå –ù–µ —Å–¥–µ–ª–∞–Ω–æ';
        statusClass = 'status-not-done';
      }

      totalPlannedTasks += plan;
      totalFactTasks += fact;
      totalTasks++;

      tasksHtml += `
        <tr>
          <td>${task}</td>
          <td>${type}</td>
          <td>${plan}</td>
          <td>${fact}</td>
          <td class="${statusClass}">${statusText}</td>
          <td>${comment}</td>
        </tr>
      `;
    });

    const donePercent = totalTasks > 0 ? Math.round((doneCount / totalTasks) * 100) : 0;
    const tasksPerfPercent = totalPlannedTasks > 0 ? Math.round((totalFactTasks / totalPlannedTasks) * 100) : 0;

    // –í—Ä–µ–º—è
    const timeRows = document.querySelectorAll('#timeTable tbody tr');
    let timeHtml = '';
    timeRows.forEach(row => {
      const tds = row.querySelectorAll('td');
      const task = tds[0].querySelector('input').value;
      const start = tds[1].querySelector('input').value;
      const end = tds[2].querySelector('input').value;
      const comment = tds[3].querySelector('input').value;
      timeHtml += `
        <tr>
          <td>${task}</td>
          <td>${start}</td>
          <td>${end}</td>
          <td>${comment}</td>
        </tr>
      `;
    });

    const preview = document.getElementById('reportPreview');
    preview.style.display = 'block';
    preview.innerHTML = `
      <h2>üìã –û—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ</h2>
      <p><strong>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</strong> ${employee || '-'}<br>
         <strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> ${role || '-'}<br>
         <strong>–î–∞—Ç–∞:</strong> ${date || '-'}<br>
         <strong>–û—Ç–¥–µ–ª:</strong> –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</p>

      <h3>üî• –§–æ–∫—É—Å –¥–Ω—è</h3>
      <p>${(focus || '').replace(/\n/g,'<br>')}</p>

      <h3>üìù –ü–ª–∞–Ω –∑–∞–¥–∞—á –Ω–∞ –¥–µ–Ω—å</h3>
      <p>${(dayPlan || '').replace(/\n/g,'<br>')}</p>

      <h3>üìä –ü–ª–∞–Ω / —Ñ–∞–∫—Ç –ø–æ –ª–∏–¥–∞–º</h3>
      <div class="summary-box">
        <div><strong>–í—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤:</strong> ${leadsTotal}</div>
        <div><strong>% –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:</strong> ${leadsDonePercent}%</div>
        <div><strong>–ü–ª–∞–Ω –ª–∏–¥–æ–≤ –≤—Å–µ–≥–æ:</strong> ${leadsPlanTotal}</div>
        <div><strong>–§–∞–∫—Ç –ª–∏–¥–æ–≤ –≤—Å–µ–≥–æ:</strong> ${leadsFactTotal}</div>
        <div><strong>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ –ª–∏–¥–∞–º:</strong> ${leadsPercent}%</div>
      </div>
      <table>
        <thead>
          <tr>
            <th>–ö–∞–Ω–∞–ª</th>
            <th>–ü–ª–∞–Ω –ª–∏–¥–æ–≤</th>
            <th>–§–∞–∫—Ç –ª–∏–¥–æ–≤</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          </tr>
        </thead>
        <tbody>
          ${leadsHtml}
        </tbody>
      </table>

      <h3>üìå –ü–ª–∞–Ω / —Ñ–∞–∫—Ç –ø–æ –∑–∞–¥–∞—á–∞–º</h3>
      <div class="summary-box">
        <div><strong>–í—Å–µ–≥–æ –∑–∞–¥–∞—á:</strong> ${totalTasks}</div>
        <div><strong>% –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á:</strong> ${donePercent}%</div>
        <div><strong>–ü–ª–∞–Ω (–µ–¥–∏–Ω–∏—Ü —Ä–∞–±–æ—Ç) –≤—Å–µ–≥–æ:</strong> ${totalPlannedTasks}</div>
        <div><strong>–§–∞–∫—Ç (–µ–¥–∏–Ω–∏—Ü —Ä–∞–±–æ—Ç) –≤—Å–µ–≥–æ:</strong> ${totalFactTasks}</div>
        <div><strong>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ –∑–∞–¥–∞—á–∞–º:</strong> ${tasksPerfPercent}%</div>
      </div>
      <table>
        <thead>
          <tr>
            <th>–ó–∞–¥–∞—á–∞</th>
            <th>–¢–∏–ø</th>
            <th>–ü–ª–∞–Ω</th>
            <th>–§–∞–∫—Ç</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          </tr>
        </thead>
        <tbody>
          ${tasksHtml}
        </tbody>
      </table>

      <h3>‚è± –£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
      <table>
        <thead>
          <tr>
            <th>–ó–∞–¥–∞—á–∞ / –±–ª–æ–∫</th>
            <th>–ù–∞—á–∞–ª–æ</th>
            <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          </tr>
        </thead>
        <tbody>
          ${timeHtml}
        </tbody>
      </table>

      <h3>üìå –ò—Ç–æ–≥–∏ –¥–Ω—è</h3>
      <p><strong>–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ö–æ—Ä–æ—à–æ:</strong><br>${(good || '').replace(/\n/g,'<br>')}</p>
      <p><strong>–ß—Ç–æ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ / –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ:</strong><br>${(bad || '').replace(/\n/g,'<br>')}</p>
      <p><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞:</strong><br>${(tomorrow || '').replace(/\n/g,'<br>')}</p>
    `;
    window.scrollTo({ top: preview.offsetTop - 10, behavior: 'smooth' });
  }

  async function downloadPDF() {
    const element = document.getElementById('reportPreview');
    if (!element || element.style.display === 'none') {
      alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç".');
      return;
    }

    try {
      const canvas = await html2canvas(element, {
        scale: 2,
        useCORS: true,
        logging: false
      });

      const imgData = canvas.toDataURL('image/jpeg', 0.98);
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');
      
      const imgWidth = 210; // A4 width in mm
      const pageHeight = 297; // A4 height in mm
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      let heightLeft = imgHeight;
      let position = 0;

      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;

      while (heightLeft > 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }

      pdf.save('otchet-marketing.pdf');
    } catch (error) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF: ' + error.message);
      console.error(error);
    }
  }
</script>

</body>
</html>
